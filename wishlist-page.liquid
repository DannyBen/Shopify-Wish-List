{% if customer %}
	<ul>
		{% for tag in customer.tags %}
			{% assign the_test = '' %}
			{% capture tagID %}{{ tag }}{% endcapture %}
			{% for tag in customer.tags %}
				{% capture curTag %}{{ tag }}{% endcapture %}
				{% if curTag contains tagID %}
					{% if tagID.size | minus:curTag.size == 0 %}
						{% assign the_test = tagID %}
					{% else %}
						{% assign the_test = '' %}
					{% endif %}
				{% endif %}
			{% endfor %}	
		
			{% for collection in collections %}
				{% paginate collection.products by collection.all_products_count %}
					{% for product in collection.products %}
						{% capture productID %}{{ product.id }}{% endcapture %}
						{% unless used contains productID %}
							{% assign check = tag.size | minus:productID.size | modulo:2 %}
							{% if check == 0 %}{% assign display_product = true %}{% else %}{% assign display_product = false %}{% endif %}
							{% if display_product and the_test contains productID %}
								<li>
									<a href='{{ product.url }}'>{{ product.title }}</a><br />
									<a href='javascript:void(0)' onclick="removeTag('x{{ tagID }}')">remove</a><br />
									<a href='javascript:void(0)' onclick="addToCart('{{ product.variants[0].id }}')">add to cart</a>
								</li>
								{% capture used %}{{ productID }} {{ used }}{% endcapture %}
							{% endif %}
						{% endunless %}
					{% endfor %}
				{% endpaginate %}
			{% endfor %}
		{% endfor %}
	</ul>
	
	{% form 'customer' %}	
		<input type='hidden' name='contact[email]' value='{{ customer.email }}'/>
		<input type='hidden' name='contact[tags]' id='remove-value' value='' />
	{% endform %}
	
	<form action='/cart/add' id='add-variant' method='post'>
		<input type='hidden' name='id' id='product-select' value='' />
	</form>
	
	<script type='text/javascript'>
		function removeTag(tagID) {
			$('#remove-value').val(tagID);
			$('form.contact-form').submit();
		}
		function addToCart(variantID) {
			$('product-select').val(variantID);
			$('form#add-variant').submit();
		}
	</script>
	
	{% capture subject %}My%20{{ shop.name | replace: ' ','%20' }}%20Wish%20List{% endcapture %}
	{% capture body %}I&rsquo;ve%20added%20the%20following%20items%20to%20my%20wish%20list%20at%20{{ shop.name | replace: ' ','%20' }}{% endcapture %}
	{% capture body %}{{ body }}{% for tag in customer.tags %}{% assign the_test = '' %}{% capture tagID %}{{ tag }}{% endcapture %}{% for tag in customer.tags %}{% capture curTag %}{{ tag }}{% endcapture %}{% if curTag contains tagID %}{% if tagID.size | minus:curTag.size == 0 %}{% assign the_test = tagID %}{% else %}{% assign the_test = '' %}{% endif %}{% endif %}{% endfor %}{% for collection in collections %}{% paginate collection.products by collection.all_products_count %}{% for p in collection.products %}{% capture pID %}{{ p.id }}{% endcapture %}{% unless email_used contains pID %}{% assign check = tag.size | minus:productID.size | modulo:2 %}{% if check == 0 %}{% assign display_product = true %}{% else %}{% assign display_product = false %}{% endif %}{% if display_product and the_test contains pID %}%0A%0A{{ p.title | replace: ' ','%20' }}%3A%20%20{{ shop.url }}{{ p.url }}{% capture email_used %}{{ pID }} {{ email_used }}{% endcapture %}{% endif %}{% endunless %}{% endfor %}{% endpaginate %}{% endfor %}{% endfor %}{% endcapture %}		
	<a href='mailto:?subject={{ subject }}&amp;body={{ body }}'>Share my wish list via email</a>
{% else %}
	<p>To create a wish list please <a href='/account/login'>sign in</a> or <a href='/account/register'>create an account</a>.</p>
{% endif %}